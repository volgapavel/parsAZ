# Документация веб-интерфейса ClearPic Media Monitoring

## Описание

Веб-интерфейс для системы автоматического мониторинга азербайджанских СМИ. Предоставляет удобный графический интерфейс для тестирования и демонстрации всех возможностей системы обработки новостей.

## Технологии

### Backend
- FastAPI - современный Python веб-фреймворк для создания API
- Jinja2 - шаблонизатор для генерации HTML страниц
- Uvicorn - ASGI сервер для запуска приложения

### Frontend
- Bootstrap 5.3 - CSS фреймворк для адаптивного дизайна
- Font Awesome 6.4 - библиотека иконок
- Chart.js 4.4 - библиотека для создания графиков
- Vanilla JavaScript - без дополнительных фреймворков

### Интеграция
- REST API - полная интеграция с существующим API системы
- PostgreSQL - опциональное хранилище данных

## Структура проекта

```
parsAZ/
├── website_app.py                  # Главное приложение FastAPI
├── requirements_website.txt        # Зависимости
├── website/
│   ├── templates/                  # HTML шаблоны
│   │   ├── index.html             # Главная страница
│   │   ├── process.html           # Обработка текста
│   │   ├── search.html            # Поиск
│   │   ├── entities.html          # Сущности
│   │   └── stats.html             # Статистика
│   └── static/                     # Статические файлы
│       ├── css/
│       │   └── style.css          # Стили
│       └── js/
│           ├── main.js            # Главная страница
│           ├── process.js         # Обработка
│           ├── search.js          # Поиск
│           ├── entities.js        # Сущности
│           └── stats.js           # Статистика
```

## Установка и запуск

### 1. Установка зависимостей

```bash
pip install -r requirements_website.txt
```

Это автоматически установит все необходимые пакеты, включая зависимости из requirements_api.txt.

### 2. Настройка базы данных (опционально)

Если нужна полная функциональность с сохранением данных:

```bash
# Создание базы данных PostgreSQL
createdb clearpic_media

# Инициализация схемы
psql -d clearpic_media -f database_schema.sql
```

Создайте файл .env с настройками:

```
DB_HOST=localhost
DB_PORT=5432
DB_NAME=clearpic_media
DB_USER=postgres
DB_PASSWORD=your_password
```

### 3. Запуск приложения

```bash
python website_app.py
```

Или через uvicorn:

```bash
uvicorn website_app:app --host 0.0.0.0 --port 8000 --reload
```

### 4. Открытие в браузере

- Веб-интерфейс: http://localhost:8000
- API документация: http://localhost:8000/api/v1/docs
- ReDoc: http://localhost:8000/api/v1/redoc

## Функциональность

### Главная страница

**URL:** http://localhost:8000

Возможности:
- Обзор системы и её основных функций
- Быстрая статистика (количество статей, сущностей, рисков)
- Навигация по разделам
- Информация о технологиях

### Обработка текста

**URL:** http://localhost:8000/process

Возможности:
- Ввод текста новости для анализа
- Заполнение метаданных (заголовок, источник, URL, дата)
- Автоматическое извлечение именованных сущностей
- Выявление связей между сущностями
- Классификация рисков
- Визуализация результатов обработки

Поля формы:
- Заголовок (обязательно)
- Текст (обязательно, минимум 50 символов)
- Источник (опционально)
- URL (опционально)
- Дата публикации (по умолчанию текущая дата)

Результаты включают:
- ID обработанной статьи
- Список извлеченных сущностей с типами
- Выявленные связи с методом и уверенностью
- Обнаруженные риски с уровнями и категориями
- Статистику обработки

### Поиск

**URL:** http://localhost:8000/search

Возможности:
- Полнотекстовый поиск по базе данных
- Фильтрация по имени сущности
- Фильтрация по типу сущности
- Фильтрация по уровню риска
- Фильтрация по категории риска
- Фильтрация по диапазону дат
- Просмотр найденных статей с деталями

Типы сущностей для фильтрации:
- PERSON - персоны
- ORG - организации
- GPE - геополитические единицы
- LOC - локации
- DATE - даты
- MONEY - денежные суммы

Уровни рисков:
- none - нет риска
- low - низкий
- medium - средний
- high - высокий
- critical - критический

Категории рисков:
- fraud - мошенничество
- corruption - коррупция
- sanctions - санкции
- criminal - криминал
- environmental - экологические
- labor - трудовые
- legal - правовые
- reputation - репутационные

### Сущности

**URL:** http://localhost:8000/entities

Возможности:
- Просмотр всех извлеченных сущностей
- Фильтрация по типу сущности
- Поиск по имени
- Ограничение количества результатов
- Группировка сущностей по типам
- Переход к статьям с сущностями

Отображение:
- Группировка по типам для удобства
- Счетчик упоминаний каждой сущности
- Визуальные бейджи с цветовой кодировкой типов
- Ссылки на исходные статьи

### Статистика

**URL:** http://localhost:8000/stats

Возможности:
- Общая статистика системы
- График распределения сущностей по типам
- График распределения рисков по уровням
- График категорий рисков
- Топ источников новостей
- Список последних обработанных статей

Графики используют Chart.js:
- Круговая диаграмма для типов сущностей
- Столбчатая диаграмма для уровней рисков
- Горизонтальная диаграмма для категорий рисков

## API эндпоинты

Веб-интерфейс использует следующие API эндпоинты:

### Обработка текста
```
POST /api/v1/process
Content-Type: application/json

{
  "title": "Заголовок",
  "text": "Текст новости...",
  "source": "azadliq.org",
  "url": "https://example.com",
  "published_date": "2025-12-21"
}
```

### Поиск
```
GET /api/v1/search?query=текст&entity_name=имя&entity_type=PERSON&risk_level=high
```

### Получение сущностей
```
GET /api/v1/entities?entity_type=PERSON&limit=50
```

### Статистика
```
GET /api/v1/stats
```

### Получение статьи по ID
```
GET /api/v1/articles/{article_id}
```

### Проверка здоровья системы
```
GET /api/v1/health
GET /web-api/health
```

## Дизайн и стили

### Цветовая схема

Основные цвета:
- Primary (синий): #0d6efd - основные кнопки и заголовки
- Success (зеленый): #198754 - успешные операции
- Danger (красный): #dc3545 - ошибки и критические риски
- Warning (желтый): #ffc107 - предупреждения
- Info (голубой): #0dcaf0 - информационные блоки

Типы сущностей:
- PERSON - голубой (#e3f2fd)
- ORG - фиолетовый (#f3e5f5)
- GPE - зеленый (#e8f5e9)
- LOC - оранжевый (#fff3e0)
- DATE - розовый (#fce4ec)
- MONEY - бирюзовый (#e0f2f1)

Уровни рисков:
- none - зеленый
- low - желтый
- medium - оранжевый
- high - красный
- critical - темно-красный

### Адаптивность

Дизайн полностью адаптивен благодаря Bootstrap 5:
- Мобильные устройства (< 768px)
- Планшеты (768px - 1024px)
- Десктопы (> 1024px)

### Анимации

- Плавное появление элементов (fadeIn)
- Эффекты при наведении на карточки
- Плавная прокрутка к результатам
- Переходы цветов на кнопках

## Обработка ошибок

### Отсутствие базы данных

Если база данных не подключена:
- Функции поиска и просмотра истории недоступны
- Обработка текста работает в режиме реального времени
- Отображаются соответствующие сообщения

### Ошибки API

- 400 Bad Request - некорректные данные в запросе
- 404 Not Found - ресурс не найден
- 500 Internal Server Error - внутренняя ошибка сервера

Все ошибки отображаются пользователю в понятном виде.

### Валидация форм

- Обязательные поля помечены
- Минимальная длина текста (50 символов)
- Валидация URL адресов
- Проверка формата даты

## Производительность

### Оптимизация

- Ленивая загрузка компонентов NER моделей
- Кэширование статических файлов
- Минимизация запросов к API
- Асинхронная обработка запросов

### Рекомендации

Системные требования:
- Python 3.8+
- 8+ GB RAM (для NER моделей)
- PostgreSQL 15+ (опционально)
- Современный браузер с поддержкой ES6

Для production:
- Использовать Gunicorn или другой production WSGI сервер
- Настроить nginx для раздачи статики
- Включить кэширование
- Настроить логирование

## Безопасность

### Меры безопасности

- CORS настроен для контроля доступа
- Валидация всех входных данных через Pydantic
- Защита от SQL инъекций через параметризованные запросы
- Санитизация HTML для предотвращения XSS

### Рекомендации для production

- Использовать HTTPS
- Настроить аутентификацию и авторизацию
- Ограничить rate limiting
- Регулярно обновлять зависимости
- Использовать переменные окружения для секретов

## Расширение функциональности

### Добавление новых страниц

1. Создать HTML шаблон в website/templates/
2. Создать JS файл в website/static/js/
3. Добавить маршрут в website_app.py
4. Добавить ссылку в навигацию

### Добавление новых API эндпоинтов

1. Добавить эндпоинт в api.py
2. Создать соответствующую функцию в JS
3. Обновить документацию

### Кастомизация дизайна

Изменить переменные в style.css:
```css
:root {
    --primary-color: #your-color;
    --secondary-color: #your-color;
}
```

## Troubleshooting

### Проблема: Статика не загружается

Решение:
```bash
# Проверить существование директорий
mkdir -p website/static/css website/static/js
```

### Проблема: Модели NER долго загружаются

Решение:
- Используется ленивая загрузка
- Первый запрос займет больше времени
- Последующие запросы будут быстрее

### Проблема: База данных не подключается

Решение:
- Проверить настройки в .env
- Убедиться что PostgreSQL запущен
- Проверить права доступа пользователя

### Проблема: Ошибки CORS

Решение:
```python
# В website_app.py настроить CORS
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"]
)
```

## Примеры использования

### Пример 1: Обработка новости

1. Перейти на /process
2. Ввести заголовок: "Новое назначение в правительстве"
3. Вставить текст новости
4. Нажать "Обработать текст"
5. Просмотреть извлеченные сущности и риски

### Пример 2: Поиск по компании

1. Перейти на /search
2. В поле "Имя сущности" ввести название компании
3. Выбрать тип "ORG"
4. Нажать "Найти"
5. Просмотреть все упоминания компании

### Пример 3: Анализ рисков

1. Перейти на /search
2. Выбрать уровень риска "high"
3. Выбрать категорию "corruption"
4. Просмотреть все статьи с коррупционными рисками

## Поддержка

При возникновении проблем:
1. Проверить логи сервера
2. Проверить консоль браузера (F12)
3. Убедиться что все зависимости установлены
4. Проверить доступность API эндпоинтов

## Лицензия

ClearPic Media Monitoring System © 2025

## Контакты

Для вопросов и предложений:
- Email: yuriy.samorodov@gmail.com
- GitHub: https://github.com/volgapavel/parsAZ
